<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <link rel="icon" href="./favicon.ico"/>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
    <meta name="theme-color" content="#007aff"/>
    <meta name="description" content="íŒŒíŠ¸ë„ˆì¦ˆ ì¦ê¶Œ ê±°ë˜ì†Œ - ì‹¤ì‹œê°„ ì£¼ì‹ ê±°ë˜ ì‹œë®¬ë ˆì´ì…˜ ê²Œì„ìœ¼ë¡œ íŒ€ë³„ íˆ¬ì ì„±ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”"/>
    <meta name="keywords" content="íŒŒíŠ¸ë„ˆì¦ˆ, ì¦ê¶Œ, ì£¼ì‹, íˆ¬ì, ì‹œë®¬ë ˆì´ì…˜, ê²Œì„, ì‹¤ì‹œê°„"/>
    
    <!-- PWA ì„¤ì • -->
    <link rel="manifest" href="./manifest.json"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="íŒŒíŠ¸ë„ˆì¦ˆ ì¦ê¶Œ">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="íŒŒíŠ¸ë„ˆì¦ˆ ì¦ê¶Œ">
    <meta name="msapplication-TileColor" content="#007aff">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- ì•„ì´ì½˜ ì„¤ì • -->
    <link rel="apple-touch-icon" href="./PRX_LOGO.png"/>
    <link rel="apple-touch-startup-image" href="./PRX_STOCKMARKET_LOGO.png"/>
    
    <title>íŒŒíŠ¸ë„ˆì¦ˆ ì¦ê¶Œ ê±°ë˜ì†Œ</title>
    
    <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <!-- Supabase ì„¤ì • -->
    <script src="./config.js"></script>
    <script type="module" src="./supabase-client.js"></script>
    
    <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ -->
    <script defer="defer" src="./main.js"></script>
    <link href="./main.css" rel="stylesheet">
    
    <!-- PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ìŠ¤íƒ€ì¼ -->
    <style>
        #install-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: #007aff;
            color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
        }
        #install-prompt button {
            background: white;
            color: #007aff;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body style="margin:0;padding:0;background:#000;color:#fff">
    <noscript>JavaScriptë¥¼ í™œì„±í™”í•´ì•¼ ì´ ì•±ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</noscript>
    <div id="root" style="background:#000;min-height:100vh"></div>
    
    <!-- PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ -->
    <div id="install-prompt">
        <div style="text-align: center;">
            <h3 style="margin: 0 0 10px 0;">ğŸ“± ì•±ìœ¼ë¡œ ì„¤ì¹˜í•˜ì„¸ìš”!</h3>
            <p style="margin: 0 0 15px 0; font-size: 14px;">í™ˆ í™”ë©´ì— ì¶”ê°€í•˜ì—¬ ë” ë¹ ë¥´ê²Œ ì ‘ê·¼í•˜ì„¸ìš”</p>
            <button onclick="installPWA()">ì„¤ì¹˜í•˜ê¸°</button>
            <button onclick="dismissInstallPrompt()">ë‚˜ì¤‘ì—</button>
        </div>
    </div>
    
    <!-- PWA ì„¤ì¹˜ ë° Service Worker ë“±ë¡ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        let deferredPrompt;
        let installPromptShown = false;
        
        // Service Worker ë“±ë¡
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js')
                    .then(function(registration) {
                        console.log('Service Worker ë“±ë¡ ì„±ê³µ:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('Service Worker ë“±ë¡ ì‹¤íŒ¨:', error);
                    });
            });
        }
        
        // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì´ë²¤íŠ¸
        window.addEventListener('beforeinstallprompt', function(e) {
            e.preventDefault();
            deferredPrompt = e;
            
            // ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ê°€ ì•„ì§ í‘œì‹œë˜ì§€ ì•Šì•˜ë‹¤ë©´ í‘œì‹œ
            if (!installPromptShown) {
                showInstallPrompt();
            }
        });
        
        // ì•±ì´ ì´ë¯¸ ì„¤ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸
        window.addEventListener('appinstalled', function() {
            console.log('PWAê°€ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤');
            hideInstallPrompt();
        });
        
        function showInstallPrompt() {
            const installPrompt = document.getElementById('install-prompt');
            if (installPrompt && !installPromptShown) {
                installPrompt.style.display = 'block';
                installPromptShown = true;
            }
        }
        
        function hideInstallPrompt() {
            const installPrompt = document.getElementById('install-prompt');
            if (installPrompt) {
                installPrompt.style.display = 'none';
            }
        }
        
        function dismissInstallPrompt() {
            hideInstallPrompt();
            // 24ì‹œê°„ í›„ì— ë‹¤ì‹œ í‘œì‹œí•  ìˆ˜ ìˆë„ë¡ ì„¤ì •
            localStorage.setItem('installPromptDismissed', Date.now().toString());
        }
        
        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(function(choiceResult) {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('ì‚¬ìš©ìê°€ PWA ì„¤ì¹˜ë¥¼ ìˆ˜ë½í–ˆìŠµë‹ˆë‹¤');
                    } else {
                        console.log('ì‚¬ìš©ìê°€ PWA ì„¤ì¹˜ë¥¼ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤');
                    }
                    deferredPrompt = null;
                });
            }
            hideInstallPrompt();
        }
        
        // ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ í‘œì‹œ ì¡°ê±´ í™•ì¸
        function shouldShowInstallPrompt() {
            const dismissed = localStorage.getItem('installPromptDismissed');
            if (dismissed) {
                const dismissedTime = parseInt(dismissed);
                const now = Date.now();
                // 24ì‹œê°„(86400000ms) í›„ì— ë‹¤ì‹œ í‘œì‹œ
                return (now - dismissedTime) > 86400000;
            }
            return true;
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ í‘œì‹œ ì—¬ë¶€ í™•ì¸
        window.addEventListener('load', function() {
            if (shouldShowInstallPrompt() && !installPromptShown) {
                setTimeout(showInstallPrompt, 3000); // 3ì´ˆ í›„ í‘œì‹œ
            }
        });
    </script>
</body>
</html>


